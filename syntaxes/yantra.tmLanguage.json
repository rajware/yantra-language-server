{
  "scopeName": "source.yantra",
  "name": "Yantra",
  "patterns": [
    {
      "include": "#comment"
    },
    {
      "include": "#pragma"
    },
    {
      "include": "#tokenDefinition"
    },
    {
      "include": "#ruleDefinition"
    },
    {
      "include": "#codeBlock"
    }
  ],
  "repository": {
    "comment": {
      "patterns": [
        {
          "name": "comment.line.double-slash.yantra",
          "match": "//.*$"
        }
      ]
    },
    "pragma": {
      "patterns": [
        {
          "name": "meta.pragma.members.yantra",
          "begin": "(%members)\\s+(\\w+)",
          "beginCaptures": {
            "1": {
              "name": "keyword.other.pragma.yantra"
            },
            "2": {
              "name": "entity.name.class.yantra"
            }
          },
          "end": "(%\\})",
          "endCaptures": {
            "1": {
              "name": "meta.block.end.yantra"
            }
          },
          "patterns": [
            {
              "name": "meta.block.start.yantra",
              "match": "%\\{"
            },
            {
              "include": "source.cpp"
            }
          ]
        },
        {
          "name": "meta.pragma.generic.yantra",
          "begin": "(%[a-z_]+)",
          "beginCaptures": {
            "1": {
              "name": "keyword.other.pragma.yantra"
            }
          },
          "end": "(;)(?:(?:$\\n?)|(?:$\\z))",
          "endCaptures": {
            "1": {
              "name": "punctuation.terminator.yantra"
            }
          },
          "patterns": [
            {
              "name": "entity.name.constant.yantra",
              "match": "[A-Za-z][A-Za-z0-9_]+"
            },
            {
              "name": "string.quoted.double.yantra",
              "match": "\\\"[^\\\"]\\\""
            }
          ]
        }
      ]
    },
    "tokenDefinition": {
      "patterns": [
        {
          "name": "meta.token.definition.yantra",
          "match": "\\b([A-Z][A-Z0-9_]*)\\b\\s*(:=)\\s*(\"[^\"]*\")\\s*(!)?\\s*?(;)",
          "captures": {
            "1": {
              "name": "entity.name.constant.yantra"
            },
            "2": {
              "name": "keyword.operator.assignment.yantra"
            },
            "3": {
              "name": "string.quoted.double.yantra"
            },
            "4": {
              "name": "punctuation.terminator.yantra"
            }
          }
        }
      ]
    },
    "ruleDefinition": {
      "patterns": [
        {
          "name": "meta.rule.definition.yantra",
          "match": "\\b([a-z][a-zA-Z0-9_]*)\\b\\s*(:=).*?(;)?$",
          "captures" : {
            "1": {
              "name": "entity.name.function.yantra"
            },
            "2": {
              "name": "keyword.operator.assignment.yantra"
            },
            "3": {
              "name": "punctuation.terminator.yantra"
            }
          }
        }
      ]
    },
    "codeBlock": {
      "patterns": [
        {
          "name": "meta.embedded.block.yantra",
          "begin": "^(@\\w+)?\\s*%\\{",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.yantra"
            },
            "0": {
              "name": "meta.block.start.yantra"
            }
          },
          "end": "^%\\}",
          "endCaptures": {
            "0": {
              "name": "meta.block.end.yantra"
            }
          },
          "patterns": [
            {
              "include": "source.cpp"
            }
          ]
        }
      ]
    }
  }
}